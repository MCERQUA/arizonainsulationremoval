---
import BaseLayout from './BaseLayout.astro';
import GlassCard from '../components/ui/GlassCard.tsx';

export interface Props {
  title: string;
  description: string;
  pubDate: Date;
  author?: string;
  tags?: string[];
  image?: string;
  readTime?: string;
  schema?: {
    type?: string;
    faq?: Array<{
      question: string;
      answer: string;
    }>;
  };
}

const { 
  title, 
  description, 
  pubDate, 
  author = 'Heavy Crane Insurance Team', 
  tags = [],
  image = '/images/crane-insurance-default.jpg',
  readTime = '5 min read',
  schema
} = Astro.props;

const currentUrl = Astro.url.href;
const publishedDate = new Date(pubDate).toISOString();

// Generate structured data for the article
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "image": `https://heavycraneinsurance.com${image}`,
  "datePublished": publishedDate,
  "dateModified": publishedDate,
  "author": {
    "@type": "Organization",
    "name": author,
    "url": "https://heavycraneinsurance.com"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Heavy Crane Insurance",
    "logo": {
      "@type": "ImageObject",
      "url": "https://heavycraneinsurance.com/logo.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": currentUrl
  },
  "articleSection": "Crane Insurance",
  "keywords": tags.join(', '),
  "wordCount": "5000",
  "timeRequired": readTime
};

// Generate FAQ schema if provided
const faqSchema = schema?.faq ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": schema.faq.map(item => ({
    "@type": "Question",
    "name": item.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": item.answer
    }
  }))
} : null;
---

<BaseLayout title={title} description={description} ogImage={image}>
  <!-- Enhanced Schema.org Structured Data for Articles -->
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)}></script>
  
  {faqSchema && (
    <script type="application/ld+json" set:html={JSON.stringify(faqSchema)}></script>
  )}
  
  <!-- Additional Meta Tags for Better SEO -->
  <meta name="article:published_time" content={publishedDate} slot="head" />
  <meta name="article:author" content={author} slot="head" />
  <meta name="article:section" content="Insurance" slot="head" />
  {tags.map(tag => <meta name="article:tag" content={tag} slot="head" />)}
  
  <!-- Twitter Card Enhancements -->
  <meta name="twitter:label1" content="Reading time" slot="head" />
  <meta name="twitter:data1" content={readTime} slot="head" />
  <meta name="twitter:label2" content="Written by" slot="head" />
  <meta name="twitter:data2" content={author} slot="head" />
  <article class="min-h-screen pt-32 pb-16 bg-light-gray">
    <div class="container-padding max-w-4xl mx-auto">
      <!-- Blog Header -->
      <header class="mb-12 text-center">
        <h1 class="heading-xl text-espresso mb-6">
          {title}
        </h1>
        
        <div class="flex flex-wrap items-center justify-center gap-4 text-sm text-warm-gray">
          <span>By {author}</span>
          <span class="text-khaki">â€¢</span>
          <time datetime={pubDate.toISOString()}>
            {new Date(pubDate).toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </time>
        </div>
        
        {tags.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2 justify-center">
            {tags.map((tag) => (
              <span class="px-3 py-1 bg-sand/30 rounded-full text-xs font-medium text-taupe">
                {tag}
              </span>
            ))}
          </div>
        )}
      </header>
      
      <!-- Blog Content -->
      <GlassCard client:visible variant="white">
        <div class="blog-content max-w-none">
          <slot />
        </div>
      </GlassCard>
      
      <!-- Back to Blog -->
      <div class="mt-12 text-center">
        <a 
          href="/blog"
          class="inline-flex items-center gap-2 text-terra-cotta hover:text-terra-cotta/80 transition-colors duration-300 font-medium"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to Blog
        </a>
      </div>
    </div>
  </article>
</BaseLayout>
